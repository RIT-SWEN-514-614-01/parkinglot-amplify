<!DOCTYPE html>
<html lang="en">
    <head>
        <title>GetParked</title>
        <link
        rel="stylesheet"
        href="https://cdn.jsdelivr.net/npm/bulma@1.0.0/css/bulma.min.css"
        >
        <style>
            body {
                margin: 2rem 10rem ;
            }
        </style>
    </head>
    <body>
        <h1 class="is-size-2">Parking lot notifications:</h1>
        <b>Select the type of notification you would like to receive.</b>
        <div>

        </div>
        <h1>New notification</h1>
        <form>
            <label for="identifier">identifier</label>
            <input type="number" id="identifier"></input>
            <label for="request">request</label>
            <input type="number" id="request"></input>
            <label for="lot">lot</label>
            <input type="number" id="lot"></input>
            <label for="email">email</label>
            <input id="email"></input>
            <button id="submitButton" class="button is-link">Submit</button>
        </form>
        <select id="trackedLot">
            <option value="1">1</option>
            <option value="2">2</option>
        </select>
        <h3 id="numCars">0</h3>
        <iframe id="stream" width="1320rem" height="630rem" src="https://www.youtube.com/embed/RuiHEi2ImpI?si=p3OTkNPj_GYZ4zrZ" title="YouTube video player" frameborder="0" referrerpolicy="strict-origin-when-cross-origin" allowfullscreen></iframe>
        
        <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.1.0/jquery.min.js"></script>
        <script type="text/javascript">
            document.cookie="__Host-name=YouTube; Secure; Path=https://www.youtube.com/embed?v=RuiHEi2ImpI; SameSite=None; Partitioned;"
            var apiUrl = "https://y76833ic33.execute-api.us-east-1.amazonaws.com/prod";

            // (function(){
            //     window.setInterval(getLotData, 10000);
            //     getLotData();
            // })();

            $("#trackedLot").on("change", function(){
                var stream1 = '<iframe id="stream" width="1320rem" height="630rem" src="https://www.youtube.com/embed/RuiHEi2ImpI?si=p3OTkNPj_GYZ4zrZ" title="YouTube video player" frameborder="0" referrerpolicy="strict-origin-when-cross-origin" allowfullscreen></iframe>'
                var stream2 = '<iframe id="stream" src="https://player.twitch.tv/?channel=stopsigncam&parent=amplifyapp" frameborder="0" allowfullscreen="true" scrolling="no" height="378" width="620"></iframe>'
                $('#stream').replaceWith(eval("stream" + $("#trackedLot").val()));

                getLotData();
            })

            function getLotData(){
                $.ajax({
                    type: "GET",
                    url: apiUrl + "?trackedLot=" + $("#trackedLot").val(),
                    contentType:'application/json',
                })
                .always(function (response) {
                    $("#numCars").text(response["Items"]["0"]["numberOfCars"]["N"]);
                    console.log(response);
                    console.log(response["Items"]["0"]["numberOfCars"]["N"]);
                });
                console.log("run1");
                return false;
            }

            $("#submitButton").on("click", function(){
                $.ajax({
                    type: "POST",
                    url: apiUrl,
                    data: JSON.stringify({"identifier": $("#identifier").val(), "request": $("#request").val(), "lot": $("#lot").val(), "email": $("#email").val()}),
                    contentType: "application/json",
                });
                console.log("run2");
                return false;
            })
        </script>
    </body>
</html>